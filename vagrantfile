


require "yaml"
settings = YAML.load_file "settings.yaml"

Vagrant.configure("2") do |config|

  # Master node configuration
  config.vm.define "k8s-master" do |node|
    node.vm.box = "ubuntu/bionic64"
    node.vm.hostname = "k8s-master"
    node.vm.network "private_network", ip: settings["network"]["control_ip"], :netmask => "255.255.255.0"
    node.vm.network "forwarded_port", guest: 80, host: 9090

    node.vm.provision "shell", path: "./scripts/setup_master.sh"
    node.vm.synced_folder settings["shared_dir"][0]["host_path"], settings["shared_dir"][0]["vm_path"]
  end

  # Worker node configuration
  config.vm.define "k8s-worker" do |node|
    node.vm.box = "ubuntu/bionic64"
    node.vm.hostname = "k8s-worker"
    node.vm.network "private_network", ip: settings["network"]["control_ip"], :netmask => "255.255.255.0"
    node.vm.network "forwarded_port", guest: 80, host: 9091

    node.vm.synced_folder settings["shared_dir"][0]["host_path"], settings["shared_dir"][0]["vm_path"]
  end

end
